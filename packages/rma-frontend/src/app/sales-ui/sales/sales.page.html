<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="navigateBack()">
        <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Sales</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="page-background">
  <ion-grid class="ion-no-padding">
    <ion-row class="ion-no-padding">
      <ion-col class="ion-no-padding">
        <ion-card>
          <ion-card-header>
            <ion-row class="align">
              <ion-col>
                <ion-card-title>
                  <ion-text color="tertiary">
                    Sales Invoices
                  </ion-text>
                </ion-card-title>
              </ion-col>
              <ion-col class="ion-text-right">
                <ion-button
                  color="tertiary"
                  [routerLink]="['/sales/add-sales-invoice', 'add']"
                >
                  Add
                </ion-button>
              </ion-col>
            </ion-row>
          </ion-card-header>
          <div class="loading-shade" *ngIf="dataSource.loading$ | async">
            <mat-progress-bar
              *ngIf="dataSource.loading$ | async"
              mode="indeterminate"
            ></mat-progress-bar>
          </div>
          <ion-card-content class="ion-padding">
            <ion-grid>
              <ion-row>
                <ion-col>
                  <mat-form-field class="full-width">
                    <input
                      matInput
                      placeholder="Invoice Number"
                      [(ngModel)]="name"
                      (keyup.enter)="setFilter()"
                    />
                  </mat-form-field>
                </ion-col>
                <ion-col>
                  <mat-form-field class="full-width">
                    <mat-label>Status</mat-label>
                    <mat-select
                      [(value)]="status"
                      (selectionChange)="statusChange($event.value)"
                    >
                      <mat-option
                        *ngFor="let status of invoiceStatus"
                        [value]="status"
                      >
                        {{status}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </ion-col>
              </ion-row>
              <ion-row>
                <ion-col>
                  <mat-form-field class="full-width">
                    <input
                      matInput
                      placeholder="Customer"
                      [(ngModel)]="customer"
                      (keyup.enter)="setFilter()"
                    />
                  </mat-form-field>
                </ion-col>
                <ion-col>
                  <mat-form-field class="full-width">
                    <input
                      matInput
                      placeholder="Branch"
                      [(ngModel)]="branch"
                      (keyup.enter)="setFilter()"
                    />
                  </mat-form-field>
                </ion-col>
              </ion-row>
            </ion-grid>
            <table
              mat-table
              class="full-width-table"
              [dataSource]="dataSource"
              matSort
              (matSortChange)="setFilter($event)"
              aria-label="Elements"
              style="width: 100%;"
            >
              <!-- customer Column -->
              <ng-container matColumnDef="customer">
                <th mat-header-cell *matHeaderCellDef>
                  Customer
                </th>
                <td mat-cell *matCellDef="let row">
                  {{row.customer}}
                </td>
              </ng-container>

              <!-- name Column -->
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>
                  Invoice No
                </th>
                <td mat-cell *matCellDef="let row">
                  {{row.name}}
                </td>
              </ng-container>

              <ng-container matColumnDef="created_by">
                <th mat-header-cell *matHeaderCellDef>
                  Created By
                </th>
                <td mat-cell *matCellDef="let row">
                  {{ row.createdByEmail }}
                </td>
              </ng-container>

              <ng-container matColumnDef="delivered_by">
                <th mat-header-cell *matHeaderCellDef>
                  Delivered By
                </th>
                <td mat-cell *matCellDef="let row">
                  {{ (row.delivery_note_items.length === 0) ? '' :
                  row.delivery_note_items[0]?.deliveredByEmail }}
                </td>
              </ng-container>
              <!-- posting_date Column -->
              <ng-container matColumnDef="posting_date">
                <th
                  mat-header-cell
                  mat-sort-header="posting_date"
                  *matHeaderCellDef
                >
                  Date
                </th>
                <td mat-cell *matCellDef="let row">
                  {{row.posting_date}}
                </td>
              </ng-container>

              <!-- territory Column -->
              <ng-container matColumnDef="territory">
                <th mat-header-cell *matHeaderCellDef>
                  Branch
                </th>
                <td mat-cell *matCellDef="let row">
                  {{row.territory}}
                </td>
              </ng-container>

              <!-- total_qty Column -->
              <!-- <ng-container matColumnDef="total_qty">
                <th mat-header-cell *matHeaderCellDef>
                  Quantity
                </th>
                <td mat-cell *matCellDef="let row">
                  {{row.total_qty}}
                </td>
              </ng-container> -->

              <!-- Status Column -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let row">
                  <ion-text
                    [ngStyle]="{
                    color: 'green'
                  }"
                    *ngIf="row.status === 'To Deliver' || row.status === 'Completed' "
                  >
                    {{row.status}}
                  </ion-text>
                  <ion-text
                    *ngIf="row.status === 'Draft' || row.status === 'Rejected' || row.status === 'Canceled' "
                    [ngStyle]="{
                    color: 'red'
                  }"
                  >
                    {{row.status}}
                  </ion-text>
                </td>
              </ng-container>

              <ng-container matColumnDef="total">
                <th mat-header-cell *matHeaderCellDef>
                  Invoice Amount
                </th>
                <td mat-cell *matCellDef="let row">
                  {{row.total | curFormat | async }}
                </td>
              </ng-container>

              <tr
                mat-header-row
                *matHeaderRowDef="displayedColumns; sticky: true"
              ></tr>
              <tr
                mat-row
                *matRowDef="let row; columns: displayedColumns;"
                (click)="navigateBasedOnRoles(row)"
              ></tr>
            </table>

            <mat-card-actions>
              <mat-paginator
                #paginator
                class="mat-paginator-sticky"
                (page)="getUpdate($event)"
                [length]="dataSource.length"
                [pageSizeOptions]="[10, 50, 100, 500]"
              >
              </mat-paginator>
            </mat-card-actions>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
